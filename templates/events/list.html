{% extends 'base.html' %}

{% block title %}Events - SkillStudio{% endblock %}

{% block content %}
<div class="container mx-auto px-6 py-8">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-4xl font-bold mb-2">Events & Webinars</h1>
        <p class="text-gray-400">Join live sessions and networking events</p>
    </div>

    <!-- Filters -->
    <div class="bg-dark-surface border border-dark-border rounded-lg p-6 mb-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <input type="text" id="search-events" placeholder="Search events..."
                class="md:col-span-2 px-4 py-3 bg-dark-bg border border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500">
            <select id="filter-type" class="px-4 py-3 bg-dark-bg border border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="">All Types</option>
                <option value="webinar">Webinar</option>
                <option value="workshop">Workshop</option>
                <option value="networking">Networking</option>
                <option value="conference">Conference</option>
            </select>
            <select id="filter-time" class="px-4 py-3 bg-dark-bg border border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="upcoming">Upcoming</option>
                <option value="past">Past</option>
                <option value="today">Today</option>
            </select>
        </div>
    </div>

    <!-- Events List -->
    <div id="events-container" class="space-y-6">
        <!-- Loading skeleton -->
        <div class="animate-pulse bg-dark-surface border border-dark-border rounded-lg h-32"></div>
        <div class="animate-pulse bg-dark-surface border border-dark-border rounded-lg h-32"></div>
        <div class="animate-pulse bg-dark-surface border border-dark-border rounded-lg h-32"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadEvents();

    // Filters
    document.getElementById('search-events').addEventListener('input', debounce(loadEvents, 500));
    document.getElementById('filter-type').addEventListener('change', loadEvents);
    document.getElementById('filter-time').addEventListener('change', loadEvents);
});

function debounce(func, wait) {
    let timeout;
    return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func(...args), wait);
    };
}

async function loadEvents() {
    const container = document.getElementById('events-container');
    container.innerHTML = '<div class="flex justify-center py-12"><div class="animate-spin h-12 w-12 border-4 border-blue-500 border-t-transparent rounded-full"></div></div>';

    try {
        const search = document.getElementById('search-events').value;
        const type = document.getElementById('filter-type').value;
        const time = document.getElementById('filter-time').value;

        const params = new URLSearchParams();
        if (search) params.append('search', search);
        if (type) params.append('event_type', type);
        if (time === 'upcoming') params.append('upcoming', 'true');
        if (time === 'past') params.append('past', 'true');
        if (time === 'today') params.append('today', 'true');

        const response = await fetch(`/api/events/?${params.toString()}`);
        const data = await response.json();

        if (data.results && data.results.length > 0) {
            container.innerHTML = data.results.map(event => `
                <a href="/events/${event.id}/" class="block bg-dark-surface border border-dark-border rounded-lg p-6 hover:border-purple-500 transition-all hover:shadow-lg hover:shadow-purple-500/10">
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                            <div class="w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex flex-col items-center justify-center">
                                <span class="text-2xl font-bold">${new Date(event.start_datetime).getDate()}</span>
                                <span class="text-xs uppercase">${new Date(event.start_datetime).toLocaleDateString('en-US', { month: 'short' })}</span>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start justify-between mb-2">
                                <h3 class="text-xl font-semibold">${event.title}</h3>
                                <span class="px-3 py-1 text-xs rounded-full bg-purple-900/50 text-purple-300 capitalize">
                                    ${event.event_type}
                                </span>
                            </div>
                            <p class="text-gray-400 mb-3 line-clamp-2">${event.description || 'No description'}</p>
                            <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500">
                                <div class="flex items-center space-x-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <span>${new Date(event.start_datetime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</span>
                                </div>
                                ${event.location ? `
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        </svg>
                                        <span>${event.location}</span>
                                    </div>
                                ` : ''}
                                <div class="flex items-center space-x-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                                    </svg>
                                    <span>${event.attendees_count || 0} attending</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </a>
            `).join('');
        } else {
            container.innerHTML = `
                <div class="text-center py-16 bg-dark-surface border border-dark-border rounded-lg">
                    <svg class="w-20 h-20 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    <p class="text-gray-400 text-lg">No events found</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading events:', error);
        container.innerHTML = '<div class="text-center py-16 text-red-400">Failed to load events</div>';
    }
}
</script>
{% endblock %}
